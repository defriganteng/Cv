<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .sidebar {
            transition: all 0.3s;
        }
        .content-area {
            transition: all 0.3s;
        }
        @media (max-width: 768px) {
            .sidebar {
                margin-left: -100%;
            }
            .sidebar.active {
                margin-left: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Mobile Menu Button -->
    <button class="md:hidden fixed top-4 right-4 z-50 p-2 bg-blue-500 text-white rounded-lg" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar fixed h-full w-64 bg-white shadow-lg z-40">
        <div class="p-4">
            <h2 class="text-2xl font-bold text-blue-600">ERP System</h2>
        </div>
        
        <nav class="mt-6">
            <div class="px-4">
                <a href="#dashboard" class="menu-item block p-2 text-gray-700 hover:bg-blue-50 rounded-lg">
                    <i class="fas fa-home mr-2"></i> Dashboard
                </a>
                
                <div class="dropdown">
                    <a href="#keuangan" class="menu-item block p-2 text-gray-700 hover:bg-blue-50 rounded-lg">
                        <i class="fas fa-wallet mr-2"></i> Keuangan
                        <i class="fas fa-chevron-down float-right mt-1 text-sm"></i>
                    </a>
                    <div class="dropdown-content hidden pl-4">
                        <a href="#pembukuan" class="submenu-item block p-2 text-sm text-gray-600 hover:bg-blue-50 rounded-lg">
                            <i class="fas fa-book mr-2"></i> Pembukuan
                        </a>
                        <a href="#laporan" class="submenu-item block p-2 text-sm text-gray-600 hover:bg-blue-50 rounded-lg">
                            <i class="fas fa-chart-bar mr-2"></i> Laporan Laba/Rugi
                        </a>
                    </div>
                </div>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="content-area ml-0 md:ml-64 min-h-screen p-4">
        <!-- Dashboard Content -->
        <div id="dashboardContent">
            <div class="mb-6">
                <h1 class="text-2xl font-bold text-gray-800">Dashboard</h1>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-gray-500 text-sm mb-2">Total Saldo</h3>
                    <p class="text-2xl font-bold" id="dashboardBalance">Rp 0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-gray-500 text-sm mb-2">Total Pendapatan</h3>
                    <p class="text-2xl font-bold text-green-600" id="dashboardIncome">Rp 0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-gray-500 text-sm mb-2">Total Beban</h3>
                    <p class="text-2xl font-bold text-red-600" id="dashboardExpense">Rp 0</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-gray-500 text-sm mb-2">Laba/Rugi Bersih</h3>
                    <p class="text-2xl font-bold text-blue-600" id="dashboardNetProfit">Rp 0</p>
                </div>
            </div>
        </div>

        <!-- Content Container -->
        <div id="contentContainer" class="hidden">
            <iframe id="contentFrame" class="w-full h-screen border-none"></iframe>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwlH1A8xC94pG95QiuCVExbLrcByMw_Kibq8vyzrrFygXEg8B1DH5_naGeMjcBq8iSzMw/exec';
        
        // Toggle mobile menu
        document.getElementById('mobileMenuBtn').addEventListener('click', () => {
            document.querySelector('.sidebar').classList.toggle('active');
        });

        // Menu navigation
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Close dropdown when clicking main menu
                if(this.parentElement.classList.contains('dropdown')) {
                    this.parentElement.querySelector('.dropdown-content').classList.toggle('hidden');
                }

                // Hide all submenus except current
                document.querySelectorAll('.dropdown-content').forEach(dropdown => {
                    if(dropdown !== this.parentElement.querySelector('.dropdown-content')) {
                        dropdown.classList.add('hidden');
                    }
                });

                // Handle navigation
                const target = this.getAttribute('href');
                if(target === '#dashboard') {
                    showDashboard();
                }
            });
        });

        // Submenu navigation
        document.querySelectorAll('.submenu-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const target = this.getAttribute('href');
                
                if(target === '#pembukuan') {
                    showContent('erp.html');
                } else if(target === '#laporan') {
                    showContent('dashboard.html');
                }
                
                // Close mobile menu
                if(window.innerWidth < 768) {
                    document.querySelector('.sidebar').classList.remove('active');
                }
            });
        });

        function showDashboard() {
            document.getElementById('dashboardContent').classList.remove('hidden');
            document.getElementById('contentContainer').classList.add('hidden');
            fetchDashboardData();
        }

        function showContent(url) {
            document.getElementById('dashboardContent').classList.add('hidden');
            document.getElementById('contentContainer').classList.remove('hidden');
            document.getElementById('contentFrame').src = url;
        }

        // Fetch data for dashboard
        async function fetchDashboardData() {
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getAll`);
                const result = await response.json();
                
                if(result.success) {
                    const data = result.data;
                    let totalIncome = 0;
                    let totalExpense = 0;

                    data.forEach(transaction => {
                        if(transaction.income) totalIncome += parseFloat(transaction.income);
                        if(transaction.expense) totalExpense += parseFloat(transaction.expense);
                    });

                    const balance = totalIncome - totalExpense;
                    
                    document.getElementById('dashboardBalance').textContent = formatCurrency(balance);
                    document.getElementById('dashboardIncome').textContent = formatCurrency(totalIncome);
                    document.getElementById('dashboardExpense').textContent = formatCurrency(totalExpense);
                    document.getElementById('dashboardNetProfit').textContent = formatCurrency(balance);
                }
            } catch(error) {
                console.error('Error:', error);
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        // Initial load
        fetchDashboardData();
    </script>
</body>
</html>
